<!DOCTYPE html>
<html>
<head>
	<style>
	/* Make canvas full size */
	canvas {
	    position:fixed;
	    left:0;
	    top:0;
	    width:100%;
	    height:100%;
	}
	</style>
	<title>Ping Pong Game</title>
</head>
<body>
	<canvas id="canvas" width="800" height="400"></canvas>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript">
		//Sample functions, remove these functions and design ping-pong game with onInit and onUpdate.

		app.onInit = function(){
/*
			this.nodes.push({
				id : 'background',
				x  : 0,
				y  : 0,
				width  : canvas.width,
				height : canvas.height,
				color  : 'black'
			});
*/
			this.nodes.push({
				id : 'keypress',
				w  : false,
				s  : false,
				uparrow  : false,
				downarrow : false,
				space : false
			});

			this.nodes.push({
				id : 'red-box',
				x  : 0,
				y  : 0,
				width  : canvas.width*.05,
				height : canvas.height*.25,
				color  : 'red'
			});

			this.nodes.push({
				id : 'black-box',
				x  : canvas.width-(canvas.width*.05),
				y  : 0,
				width  : canvas.width*.05,
				height : canvas.height*.25,
				color  : 'black'
			});

			this.nodes.push({
				id : 'ball',
				x  : canvas.width/2-50,
				y  : canvas.height/2-25,
				radius: canvas.width*.01+canvas.height*.01,
				width  : canvas.width*.1,
				height : canvas.height*.1,

				velocityX: (4*rand_1_or_neg1()),
				velocityY: (4*rand_1_or_neg1()),
				//left / right direction as 0/1
				direction: 1,
				color  : 'black'
			})

			this.nodes.push({
				id : 'gamestate',
				gamestate  :0,
				});

				this.nodes.push({
					id : 'score',
					team1_score: 0,
					team2_score: 0
				});

				this.nodes.push({
					id : 'speed',
					speed: 2
				});

		};

		//random number between 1 and negative 1
		function rand_1_or_neg1()
		{
			var rand = (Math.floor(Math.random() * 2)+1)
			if (rand == 2)
				rand = -1
			if (rand == 1)
				rand = 1
			return(rand)
		}


			document.addEventListener("keydown", (e) =>
		{
			if (e.key == "w")
			{
				app.getNode('keypress').w = true;
			}
			if (e.key == "s")
			{
				app.getNode('keypress').s = true;
			}

			if (e.key == "ArrowUp")
			{
				app.getNode('keypress').uparrow = true;
			}
			if (e.key == "ArrowDown")
			{
				app.getNode('keypress').downarrow = true;
			}
			if (e.key == "space" || e.keyCode == 32)
			{
				app.getNode('keypress').space = true;
			}
			//console.log(e.keyCode)
		})
		document.addEventListener("keyup", (e) =>
		{
			if (e.key == "w")
			{
				app.getNode('keypress').w = false;
			}
			if (e.key == "s")
			{
				app.getNode('keypress').s = false;
			}
			if (e.key == "ArrowUp")
			{
				app.getNode('keypress').uparrow = false;
			}
			if (e.key == "ArrowDown")
			{
				app.getNode('keypress').downarrow = false;
			}
			if (e.key == "space" || e.keyCode == 32)
			{
				app.getNode('keypress').space = false;
				pause_unpause()
			}
		})
		function pause_unpause()
		{
			if (app.getNode('gamestate').gamestate == 1)
				app.getNode('gamestate').gamestate = 0
			else if (app.getNode('gamestate').gamestate == 0)
					app.getNode('gamestate').gamestate = 1
		}
		function moveBall()
		{
						//Move ball
						app.getNode('ball').x += app.getNode('ball').velocityX
						app.getNode('ball').y += app.getNode('ball').velocityY
						//reverse direction
						if (app.getNode('ball').y >= (canvas.height-app.getNode('ball').height) || app.getNode('ball').y <= 0)
						{
							app.getNode('ball').velocityY  = app.getNode('ball').velocityY * -1
						}
		}
		function movePlayer()
		{
			if (app.getNode('keypress').w == true)
				if (app.getNode('black-box').y > 0)
				{
					app.getNode('black-box').y -= app.getNode('speed').speed
				}
			if (app.getNode('keypress').s == true)
				if (app.getNode('black-box').y < canvas.height-app.getNode('black-box').height)
				{
					app.getNode('black-box').y += app.getNode('speed').speed
				}

				if (app.getNode('keypress').uparrow == true)
					if (app.getNode('red-box').y > 0)
					{
						app.getNode('red-box').y -= app.getNode('speed').speed
					}
				if (app.getNode('keypress').downarrow == true)
					if (app.getNode('red-box').y < canvas.height-app.getNode('red-box').height)
					{
						app.getNode('red-box').y += app.getNode('speed').speed
					}
		}
		function paddleCollision()
		{
			//Function returns 1 if collision left paddle and 2 if collision right paddle
			//simplify expresisons a bit
			let ballX = app.getNode('ball').x,
			ballY = app.getNode('ball').y,
			lpaddleX = app.getNode('red-box').x,
			lpaddleY = app.getNode('red-box').y,
			lpaddleWidth = app.getNode('red-box').width,
			lpaddleHeight = app.getNode('red-box').height

			rpaddleX = app.getNode('black-box').x,
			rpaddleY = app.getNode('black-box').y,
			rpaddleWidth = app.getNode('black-box').width,
			rpaddleHeight = app.getNode('black-box').height
			//if left paddle hits, return 1

			if (ballY > lpaddleY
			&& ballY < lpaddleY+lpaddleHeight
			&& ballX < lpaddleX+lpaddleWidth
			)
			// if right paddle hits, return 1
				return(1)

				if (ballY > rpaddleY
				&& ballY < rpaddleY+rpaddleHeight
				&& ballX > rpaddleX-app.getNode('ball').width
				)
					return(2)
			//return 0 if both fail
			return(0)
		}
		function checkScore()
		{
			if (app.getNode('ball').x-app.getNode('ball').width > canvas.width)
			{
				app.getNode('score').team2_score++
				console.log("Score: "+  app.getNode('score').team1_score + " to " + app.getNode('score').team2_score)
				reset_game()
			}
			if (app.getNode('ball').x+app.getNode('ball').width < 0)
			{
				app.getNode('score').team1_score++
				console.log("Score: " + app.getNode('score').team1_score + " to " + app.getNode('score').team2_score)
				reset_game()
			}
		}
		function reset_game()
		{
			app.getNode('ball').x = canvas.width/2-50
			app.getNode('ball').y = canvas.height/2-25
			app.getNode('ball').velocityX = (3*rand_1_or_neg1())
			app.getNode('ball').velocityY = (3*rand_1_or_neg1())

		}
		app.onUpdate = function(time){
			//Score in top left and right middle
			app.drawText((canvas.width/2)+(canvas.width/4),canvas.height/6,	"black",app.getNode('score').team1_score)
			app.drawText((canvas.width/4),canvas.height/6,	"red",app.getNode('score').team2_score)

			//app.drawCircle(200,200,10,"yellow")
			if (app.getNode('gamestate').gamestate == 1)
			{
				moveBall()
				movePlayer()
				if (paddleCollision() == 1 && app.getNode('ball').velocityX < 0)
				{
					app.getNode('ball').velocityX *= rand_1_or_neg1()
				}
				else if (paddleCollision() == 2 && app.getNode('ball').velocityX > 0)
				{
					app.getNode('ball').velocityX *= rand_1_or_neg1()
				}

				checkScore()
			}

		};
	</script>
</body>
</html>
